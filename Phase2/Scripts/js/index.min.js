!function(e,a,t,r){"use strict";var n=t(".l-load"),l=t(".l-content"),s=t(".l-footer"),i={Element:t(".jQ-lock").find("span"),Total:0,Replay:!1,Win:["1","9","6",null],OnClick:function(){t(".jQ-section").addClass(t(".jQ-section").data("lock"));for(var e=0;e<i.Element.length;e++)i.Start.Arrays.push(0),i.Start.TimeOut.push(null),i.Start.Checked.push(null);i.GetResult(),i.Numbers()},GetResult:function(){var e=this,a=null;t.post("/api/lottery/"+Projects.Factory.FB.UserID,function(e){},"json").then(function(r){99!==r&&2!==r?(e.Random(),a=t(".jQ-result").data("miss"),3!==r?(e.Replay=!0,0===r?(i.Token.Get(),t(".jQ-result-check").addClass(t(".jQ-result-check").data("form")).removeClass(t(".jQ-result-check").data("end"))):1===r&&t(".jQ-result-check").addClass(""+t(".jQ-result-check").data("replay")+" "+t(".jQ-result-check").data("end")).removeClass(t(".jQ-result-check").data("form"))):(i.Token.Get(),t(".jQ-result-check").addClass(t(".jQ-result-check").data("form")).removeClass(t(".jQ-result-check").data("end")))):(e.Win[e.Win.length-1]="3",a=t(".jQ-result").data("win"),2===r?t(".jQ-result-check").addClass(""+t(".jQ-result-check").data("replay")+" "+t(".jQ-result-check").data("end")).removeClass(t(".jQ-result-check").data("form")):99===r&&(i.Token.Get(),t(".jQ-result-check").addClass(t(".jQ-result-check").data("form")).removeClass(t(".jQ-result-check").data("end")))),t(".jQ-result").addClass(a)})},Random:function(){var e=this,a=[1,2,4,5,6,7,8,9,0],t=Math.floor(Math.random()*a.length);e.Win[e.Win.length-1]=a[t]+""},Numbers:function(){var a=this,t=0,r=null;r=setInterval(function(){t<a.Element.length?(t++,a.Start.Run(t-1)):e.clearInterval(r)},300)},Start:{Idx:-1,Time:0,StopTime:5e3,Speed:35,Arrays:[],Checked:[],TimeOut:[],Run:function(e){var a=this,r=t(".jQ-lock").find("span").eq(e).find(".m-icon").first();a.Time++,t(".jQ-lock").find("> ul > li > div").eq(e).addClass(t(".jQ-lock").data("animate")),t(".jQ-lock").find("span").eq(e).append(r),a.Arrays[e]=a.Arrays[e]+=1,a.Arrays[e]>9&&(a.Arrays[e]=0),a.TimeOut[e]=setTimeout(function(){a.Run(e)},a.Speed),null!==a.Idx&&(a.StopTime/i.Element.length/a.Speed*(a.Idx+2)<a.Time&&(a.Idx+=1,a.Idx>i.Element.length&&(a.Idx=null)),0===a.Idx?i.Stop.Run(a.Idx):a.Checked[a.Idx-1]&&i.Stop.Run(a.Idx))}},Stop:{Index:0,Run:function(a){var r=this;(0!=i.Win[a]?parseInt(i.Win[a],10)-1:9)==t(".jQ-lock").find("span").eq(a).find(".m-icon").first().data("number")&&(t(".jQ-lock").find("> ul > li > div").eq(a).removeClass(t(".jQ-lock").data("animate")),i.Start.Checked[a]=i.Win[a],e.clearTimeout(i.Start.TimeOut[a]),r.Index=a),r.Index===i.Element.length-1&&r.Open.Run()},Open:{StopTime:500,TimeOut:null,Run:function(){var a=this;a.TimeOut=setTimeout(function(){t(".jQ-result").removeClass(t(".jQ-result").data("hide")),e.clearTimeout(a.TimeOut)},a.StopTime)}}},Token:{Arr:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],Value:"",ChkValue:"",Get:function(){for(var e=this,a=null,t=1;20>=t;t++)a=Math.floor(Math.random()*e.Arr.length),t>8&&13>t?9==t?(e.Value=e.Value+e.Arr[12],e.ChkValue=e.ChkValue+e.Arr[12]):10==t?(e.Value=e.Value+e.Arr[18],e.ChkValue=e.ChkValue+e.Arr[18]):11==t?(e.Value=e.Value+e.Arr[27],e.ChkValue=e.ChkValue+e.Arr[27]):12==t&&(e.Value=e.Value+e.Arr[24],e.ChkValue=e.ChkValue+e.Arr[24]):e.Value=e.Value+e.Arr[a];e.Check()},Check:function(){var e=this;new RegExp(""+e.ChkValue);return e.Value.match(e.ChkValue)?!0:void 0}},Submits:function(e){var a=t(e).data("type"),r=/^[\u4E00-\u9FA5]+$/,n=/^[0-9]+$/,l=/^[^@^\s]+@[^\.@^\s]+(\.[^\.@^\s]+)+$/,s=t(e).prev(".index-result-form").find('input[name="Name"]'),i=t(e).prev(".index-result-form").find('input[name="Phone"]'),o=t(e).prev(".index-result-form").find('input[name="Email"]'),u=t('input[name="Receive"]:checked'),c="",d={FacebookId:""+Projects.Factory.FB.UserID,Name:"",Phone:"",Email:"",Receive:""};if(""!==s.val()&&r.test(s.val())?(s.parent().removeClass("is-error"),d.Name=s.val()):(s.parent().addClass("is-error"),c+=s.data("error")+"\n"),""!==i.val()&&i.val().length>=9&&n.test(i.val())?(i.parent().removeClass("is-error"),d.Phone=i.val()):(i.parent().addClass("is-error"),c+=i.data("error")+"\n"),""!==o.val()&&l.test(o.val())?(o.parent().removeClass("is-error"),d.Email=o.val()):(o.parent().addClass("is-error"),c+=o.data("error")),"win"===a&&(u.val()?(t('input[name="Receive"]').parents(".index-result-label").removeClass("is-error"),d.Receive=u.val()):(t('input[name="Receive"]').parents(".index-result-label").addClass("is-error"),c+="\n"+t('input[name="Receive"]').parents(".index-result-label").data("error"))),0===t(e).prev(".index-result-form").find(".is-error").length){var h=null,m="",p="1963年，格蘭家族以夢想裝箱 起身挑戰世界；2016年，由你解密開箱！帶走襲捲世界的夢想威士忌！",k="share.jpg";"win"===a?(h="/api/winner/",m="猴賽雷！一開年就帶走經典15年，和我一起好運吧！"):(h="/api/share/",m="吼~我需要好運！和我一起解密開箱拿格蘭菲迪15年！"),t.post(h,d,function(e){},"json").then(function(e){1===e?alert(t(".jQ-result").data("error")):(t(".jQ-result-check").addClass(t(".jQ-result-check").data("end")).removeClass(t(".jQ-result-check").data("form")),Projects.Factory.FB.Feed(m,p,k))})}else alert(c)}},o=function(){n.addClass(n.data("cloak")),setTimeout(function(){n.addClass(n.data("hide")).removeClass(n.data("cloak"))},400)};t(".jQ-open").on("click",function(e){e.preventDefault(),Projects.Factory.FB.GetLoaginState(i.OnClick)}),t(".jQ-submit").on("click",function(e){e.preventDefault(),i.Submits(this)}),t(".jQ-ga").on("click",function(e){var a=t(this),r=a.attr("ga_label");e.preventDefault(),i.Replay&&(r=a.data("replay")+a.attr("ga_label")),a.hasClass("ga_click_preventDefault")?GAPush(a.attr("ga_cat"),a.attr("ga_event"),r):GAPush(a.attr("ga_cat"),a.attr("ga_event"),r,{hitCallback:GAHitBack(a)})}),t(a).ready(function(){"Mobile"===Projects.Factory.UserAgent&&Projects.Factory.ViewHeight(l,s.height())}),t(e).bind("load",function(){Projects.Factory.LoadImg.Append(o)}),t(e).bind("resize",function(){"Mobile"===Projects.Factory.UserAgent?Projects.Factory.ViewHeight(l,s.height()):l.css("height","")})}(window,document,jQuery);